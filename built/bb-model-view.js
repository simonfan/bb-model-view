//     bb-dock
//     (c) simonfan
//     bb-dock is licensed under the MIT terms.

//     bb-model-view
//     (c) simonfan
//     bb-model-view is licensed under the MIT terms.

define("bb-dock",["require","exports","module","lodash","subject","backbone"],function(e,t,i){var o=e("lodash"),a=e("subject"),n=e("backbone"),r=i.exports=a({initialize:function(e){this.initializeBbDock(e)},initializeBbDock:function(e){e&&e.attach&&this.attach(e.attach)},invoke:function(e){if(this.attachment){var t=Array.prototype.slice.call(arguments,1);return this.attachment[e].apply(this.attachment,t)}throw new Error("No attachment attached to dock. Unable to invoke "+e)},retrieve:function(e){if(this.attachment)return this.attachment[e];throw new Error("No attachment attached to dock. Unable to retrieve "+e)},attach:function(e,t){return this.detach(),this.attachment=e,this.listenTo(e,"all",this.trigger),t&&t.silent||this.trigger("attach",e),this},detach:function(e){if(this.attachment){var t=this.attachment;this.stopListening(t),delete this.attachment,e&&e.silent||this.trigger("detach",t)}return this}});r.extendProxyMethods=function(e){var t={};return o.each(e,function(e){t[e]=o.partial(r.prototype.invoke,e)}),this.extend(t)},r.proto(n.Events);var s=r.extendProxyMethods(["get","set","escape","has","unset","clear","toJSON","sync","fetch","save","destroy","validate","isValid","url","parse","clone","isNew","hasChanged","changedAttributes","previous","previousAttributes","keys","values","pairs","invert","pick","omit"]);r.model=s;var d=r.extendProxyMethods(["toJSON","sync","add","remove","reset","set","get","at","push","pop","unshift","shift","slice","sort","pluck","where","findWhere","parse","clone","fetch","create","forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample","partition"]);r.collection=d}),define("__bb-model-view/model-to-dom/update",["require","exports","module","lodash"],function(e,t,i){{var o=e("lodash");i.exports=function(e){var t=this.stringifiers,i=o.mapValues(e.attributes,function(e,i){var o=t[i];return o?o.call(this,e):e});this.fill(i)}}}),define("__bb-model-view/model-to-dom/index",["require","exports","module","jquery.filler","./update"],function(e,t,i){var o=(e("jquery.filler"),e("./update"));i.exports=function(){this.fill=this.$el.filler(this.map),this.listenTo(this.dock,"change attach",o)}}),define("__bb-model-view/dom-to-model/read-dom-value",["require","exports","module","lodash","jquery"],function(e,t,i){var o=e("lodash"),a=e("jquery"),n={"default":function(e){return e.val()},DIV:function(e){return e.html()},INPUT:function(e){return"checkbox"===e.prop("type")?o.map(e.filter(":checked"),function(e){return a(e).val()}):e.val()}};i.exports=function(e){var t=e.prop("tagName"),i=n[t]||n["default"];return i(e)}}),define("__bb-model-view/dom-to-model/update",["require","exports","module","jquery","./read-dom-value"],function(e,t,i){var o=e("jquery"),a=e("./read-dom-value");i.exports=function(e){var t=o(e.target),i=t.data("_dock_-bound-attribute");if(i){var n=t.data("_dock_-selector"),r=this.$els[n],s=a(r),d=this.parsers[i];s=d?d.call(this,s):s,this.dock.set(i,s)}}}),define("__bb-model-view/dom-to-model/bind-input",["require","exports","module","lodash","jquery","./bind-input"],function(e,t,i){{var o=e("lodash");e("jquery"),e("./bind-input")}i.exports=function a(e,t){if(o.isArray(e))o.each(e,o.bind(function(e){a.call(this,e,t)},this));else{var i=this.$els[e]=this.$el.find(e);i.length>0&&i.data("_dock_-bound-attribute",t).data("_dock_-selector",e)}}}),define("__bb-model-view/dom-to-model/index",["require","exports","module","lodash","./update","./bind-input"],function(e,t,i){var o=e("lodash"),a=e("./update"),n=e("./bind-input");i.exports=function(){this.$els={},o.each(this.map,o.bind(function(e,t){n.call(this,e,t)},this));var e=o(this.$els).mapValues(function(e,t){return e.is(":input")?t.replace(/\s*->.*$/,""):!1}).values().compact().join(", ");this.$el.on("change",e,o.bind(a,this))}}),define("bb-model-view",["require","exports","module","lodash","bb-dock","lowercase-backbone","./__bb-model-view/model-to-dom/index","./__bb-model-view/dom-to-model/index"],function(e,t,i){{var o=(e("lodash"),e("bb-dock").model),a=e("lowercase-backbone"),n=e("./__bb-model-view/model-to-dom/index"),r=e("./__bb-model-view/dom-to-model/index");i.exports=a.view.extend({initialize:function(){a.view.prototype.initialize.apply(this,arguments),this.initializeModelDock.apply(this,arguments)},initializeModelDock:function(e){e=e||{},this.map=e.map||this.map,this.parsers=e.parsers||this.parsers,this.sringifiers=e.stringifiers||this.stringifiers,this.dock=e.dock||o(),n.call(this),r.call(this),"object"==typeof e.model&&this.dock.attach(e.model)},attach:function(e,t){return this.dock.attach(e,t),this},detach:function(e){return this.dock.detach(e),this},map:{},stringifiers:{},parsers:{}})}});