//     bb-model-view
//     (c) simonfan
//     bb-model-view is licensed under the MIT terms.

define("__bb-model-view/build-map",["require","exports","module","lodash"],function(e,i,t){var o=e("lodash"),r=/^data-.*$/;t.exports=function(e,i){var t,n;r.test(t)?(t=i.replace(r,""),n=i):r.test(n)||(t=i,n="data-"+i);var d="["+n+"]",a=e.find(d),l=o.reduce(a,function(e,i){var o=$(i).data(t);return e[o]="["+n+'="'+o+'"]',e},{});return l}}),define("__bb-model-view/model-to-dom/update",["require","exports","module","lodash"],function(e,i,t){{var o=e("lodash");t.exports=function(e){var i=this.stringifiers,t=o.mapValues(e.attributes,function(e,t){var o=i[t];return o?o.call(this,e):e});this.fill(t)}}}),define("__bb-model-view/model-to-dom/index",["require","exports","module","jquery.filler","./update"],function(e,i,t){var o=(e("jquery.filler"),e("./update"));t.exports=function(){this.fill=this.$el.filler(this.map),this.listenTo(this.model,"change",o),o.call(this,this.model)}}),define("__bb-model-view/dom-to-model/read-dom-value",["require","exports","module","lodash","jquery"],function(e,i,t){var o=e("lodash"),r=e("jquery"),n={"default":function(e){return e.val()},DIV:function(e){return e.html()},INPUT:function(e){return"checkbox"===e.prop("type")?o.map(e.filter(":checked"),function(e){return r(e).val()}):e.val()}};t.exports=function(e){var i=e.prop("tagName"),t=n[i]||n["default"];return t(e)}}),define("__bb-model-view/dom-to-model/update",["require","exports","module","jquery","./read-dom-value"],function(e,i,t){var o=e("jquery"),r=e("./read-dom-value");t.exports=function(e){var i=o(e.target),t=i.data(this.bbmvUIDAttribute);if(!_.isUndefined(t)&&this.bindings[t]){var n=this.bindings[t],d=n.attribute,a=r(i),l=this.parsers[d];a=l?l.call(this,a):a,this.model.set(d,a)}}}),define("__bb-model-view/dom-to-model/index",["require","exports","module","lodash","./update"],function(e,i,t){function o(e){return e.replace(/\s*->.*$/,"")}function r(e,i,t){if(n.isArray(i))n.each(i,function(i){r(e,i,t)});else{var d=n.uniqueId("bbmvEl_"),a=o(i),l=e.$el.find(a).filter(":input");l.length>0&&(e.bindings[d]={el:l,selector:a,attribute:t},l.data(e.bbmvUIDAttribute,d))}}var n=e("lodash"),d=e("./update");t.exports=function(){this.bindings={},n.each(this.map,n.partial(r,this));var e=n.map(this.bindings,function(e){return e.selector}).join(", ");this.$el.on("change",e,n.bind(d,this))}}),define("bb-model-view",["require","exports","module","lodash","bb-dock","lowercase-backbone","./__bb-model-view/build-map","./__bb-model-view/model-to-dom/index","./__bb-model-view/dom-to-model/index"],function(e,i,t){{var o=e("lodash"),r=(e("bb-dock").model,e("lowercase-backbone")),n=e("./__bb-model-view/build-map"),d=e("./__bb-model-view/model-to-dom/index"),a=e("./__bb-model-view/dom-to-model/index"),l=["map","parsers","stringifiers"];t.exports=r.view.extend({bbmvUIDAttribute:"bbmvUID",initialize:function(){r.view.prototype.initialize.apply(this,arguments),this.initializeModelView.apply(this,arguments)},initializeModelView:function(e){if(!this.model)throw new Error("No model set for model view.");e=e||{},o.defaults(e,o.pick(this,l)),o.assign(this,e),o.isString(this.map)&&(this.map=n(this.$el,this.map)),d.call(this),a.call(this)},map:"attribute",stringifiers:{},parsers:{}})}});