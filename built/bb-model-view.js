//     model-dock
//     (c) simonfan
//     model-dock is licensed under the MIT terms.

//     bb-model-view
//     (c) simonfan
//     bb-model-view is licensed under the MIT terms.

define("model-dock",["require","exports","module","lodash","subject","backbone"],function(e,t,i){var o=e("lodash"),r=e("subject"),a=e("backbone"),d=i.exports=r({initialize:function(e){this.initializeModelDock(e)},initializeModelDock:function(e){e&&e.model&&this.attach(e.model)},invokeModelMethod:function(e){if(this.model){var t=Array.prototype.slice.call(arguments,1);return this.model[e].apply(this.model,t)}throw new Error("No model attached to dock. Unable to invoke "+e)},retrieveModelProperty:function(e){if(this.model)return this.model[e];throw new Error("No model attached to dock. Unable to retrieve "+e)},attach:function(e,t){return this.detach(),this.model=e,this.listenTo(this.model,"all",this.trigger),t&&t.silent||this.trigger("attach",e),this},detach:function(e){if(this.model){var t=this.model;this.stopListening(t),this.model=void 0,e&&e.silent||this.trigger("detach",t)}return this}});d.proto(a.Events);var s=["get","set","escape","has","unset","clear","toJSON","sync","fetch","save","destroy","keys","values","pairs","invert","pick","omit","validate","isValid","url","parse","clone","isNew","hasChanged","changedAttributes","previous","previousAttributes"],n={};o.each(s,function(e){n[e]=o.partial(d.prototype.invokeModelMethod,e)}),d.proto(n);var l=["id","idAttribute","cid","attributes","changed","defaults","validationError","urlRoot"],u={};o.each(l,function(e){u[e]=o.partial(d.prototype.retrieveModelProperty,e)}),d.proto(u)}),define("__bb-model-view/model-to-dom/update",["require","exports","module","lodash"],function(e,t,i){{var o=e("lodash");i.exports=function(e){var t=this.stringifiers,i=o.mapValues(e.attributes,function(e,i){var o=t[i];return o?o.call(this,e):e});this.fill(i)}}}),define("__bb-model-view/model-to-dom/index",["require","exports","module","jquery.filler","./update"],function(e,t,i){var o=(e("jquery.filler"),e("./update"));i.exports=function(){this.fill=this.$el.filler(this.map),this.listenTo(this.dock,"change attach",o)}}),define("__bb-model-view/dom-to-model/read-dom-value",["require","exports","module","lodash","jquery"],function(e,t,i){var o=e("lodash"),r=e("jquery"),a={"default":function(e){return e.val()},DIV:function(e){return e.html()},INPUT:function(e){return"checkbox"===e.prop("type")?o.map(e.filter(":checked"),function(e){return r(e).val()}):e.val()}};i.exports=function(e){var t=e.prop("tagName"),i=a[t]||a["default"];return i(e)}}),define("__bb-model-view/dom-to-model/update",["require","exports","module","jquery","./read-dom-value"],function(e,t,i){var o=e("jquery"),r=e("./read-dom-value");i.exports=function(e){var t=o(e.target),i=t.data("_dock_-bound-attribute");if(i){var a=t.data("_dock_-selector"),d=this.$els[a],s=r(d),n=this.parsers[i];s=n?n.call(this,s):s,this.dock.set(i,s)}}}),define("__bb-model-view/dom-to-model/bind-input",["require","exports","module","lodash","jquery","./bind-input"],function(e,t,i){{var o=e("lodash");e("jquery"),e("./bind-input")}i.exports=function r(e,t){if(o.isArray(e))o.each(e,o.bind(function(e){r.call(this,e,t)},this));else{var i=this.$els[e]=this.$el.find(e);i.length>0&&i.data("_dock_-bound-attribute",t).data("_dock_-selector",e)}}}),define("__bb-model-view/dom-to-model/index",["require","exports","module","lodash","./update","./bind-input"],function(e,t,i){var o=e("lodash"),r=e("./update"),a=e("./bind-input");i.exports=function(){this.$els={},o.each(this.map,o.bind(function(e,t){a.call(this,e,t)},this));var e=o(this.$els).mapValues(function(e,t){return e.is(":input")?t.replace(/\s*->.*$/,""):!1}).values().compact().join(", ");this.$el.on("change",e,o.bind(r,this))}}),define("bb-model-view",["require","exports","module","lodash","model-dock","lowercase-backbone","./__bb-model-view/model-to-dom/index","./__bb-model-view/dom-to-model/index"],function(e,t,i){{var o=(e("lodash"),e("model-dock")),r=e("lowercase-backbone"),a=e("./__bb-model-view/model-to-dom/index"),d=e("./__bb-model-view/dom-to-model/index");i.exports=r.view.extend({initialize:function(){r.view.prototype.initialize.apply(this,arguments),this.initializeModelDock.apply(this,arguments)},initializeModelDock:function(e){this.map=e.map||this.map,this.model=e.model||this.model||r.model(),this.parsers=e.parsers||this.parsers,this.sringifiers=e.stringifiers||this.stringifiers,this.dock=o({model:this.model}),a.call(this),d.call(this),this.attach(this.model)},attach:function(e,t){return this.dock.attach(e,t),this},detach:function(e){return this.dock.detach(e),this},map:{},stringifiers:{},parsers:{}})}});